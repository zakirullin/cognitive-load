# è®¤çŸ¥è´Ÿè·çš„é‡è¦æ„ä¹‰

## ç®€ä»‹(Introduction)

è¿™ä¸–ä¸Šæœ‰å¦‚æ­¤å¤šçš„â€œæµè¡Œè¯­â€å’Œâ€œæœ€ä½³å®è·µâ€ï¼Œä½†æ˜¯è®©æˆ‘ä»¬æ¥å…³æ³¨ä¸€äº›æ›´åŸºç¡€çš„ä¸œè¥¿ã€‚é‚£å°±æ˜¯â€”â€”å¼€å‘äººå‘˜åœ¨æµè§ˆä»£ç æ—¶çš„â€œå›°æƒ‘ç¨‹åº¦â€ã€‚

å›°æƒ‘æ˜¯ä»¥æ—¶é—´å’Œé‡‘é’±ä¸ºä»£ä»·çš„ã€‚å›°æƒ‘æ˜¯ç”±é«˜*è®¤çŸ¥è´Ÿè·*é€ æˆçš„ã€‚è¿™ä¸æ˜¯ä»€ä¹ˆèŠ±å“¨çš„æŠ½è±¡æ¦‚å¿µï¼Œè€Œæ˜¯ä¸€ç§**äººç±»çš„åŸºæœ¬é™åˆ¶å› ç´ **ã€‚

ç”±äºæˆ‘ä»¬èŠ±åœ¨é˜…è¯»å’Œç†è§£ä»£ç ä¸Šçš„æ—¶é—´è¿œè¿œå¤šäºç¼–å†™ä»£ç çš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¸æ–­åœ°é—®è‡ªå·±ï¼Œæˆ‘ä»¬æ˜¯å¦åœ¨ä»£ç ä¸­åµŒå…¥äº†è¿‡å¤šçš„è®¤çŸ¥è´Ÿè·ã€‚

## è®¤çŸ¥è´Ÿè·(Cognitive load)

> â€œè®¤çŸ¥è´Ÿè·â€ï¼ˆCognitive loadï¼‰æŒ‡çš„æ˜¯å¼€å‘äººå‘˜ä¸ºäº†å®Œæˆä¸€é¡¹ä»»åŠ¡è€Œéœ€è¦è¿›è¡Œæ€è€ƒçš„é‡ã€‚

åœ¨é˜…è¯»ä»£ç æ—¶ï¼Œä½ ä¼šå°†è¯¸å¦‚å˜é‡å€¼ã€æ§åˆ¶æµé€»è¾‘å’Œè°ƒç”¨åºåˆ—ç­‰å†…å®¹æ”¾å…¥ä½ çš„è„‘æµ·ä¸­ã€‚

ä¸€èˆ¬äººåœ¨[å·¥ä½œè®°å¿†](https://baike.baidu.com/item/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BF%86/5197761)ä¸­å¤§çº¦å¯ä»¥ä¿å­˜[å››ä¸ªè¿™æ ·çš„å—](https://github.com/zakirullin/cognitive-load/issues/16)ã€‚ä¸€æ—¦è®¤çŸ¥è´Ÿè·è¾¾åˆ°è¿™ä¸ªä¸´ç•Œå€¼ï¼Œç†è§£äº‹ç‰©å°±å˜å¾—æ›´åŠ å›°éš¾ã€‚

*å‡è®¾æˆ‘ä»¬è¢«è¦æ±‚å¯¹ä¸€ä¸ªå®Œå…¨é™Œç”Ÿçš„é¡¹ç›®è¿›è¡Œä¸€äº›ä¿®å¤ã€‚å¹¶è¢«å‘ŠçŸ¥åœ¨æ­¤ä¹‹å‰ï¼Œæœ‰ä¸€ä½éå¸¸èªæ˜çš„å¼€å‘äººå‘˜åœ¨é¡¹ç›®ä¸­è´¡çŒ®äº†ä»£ç ã€‚ä½¿ç”¨äº†è®¸å¤šç‚«é…·çš„æ¶æ„ã€èŠ±å“¨çš„åº“å’Œå‰æ²¿çš„æŠ€æœ¯ã€‚æ¢å¥è¯è¯´*ï¼Œ**ä½œè€…ç»™æˆ‘ä»¬å¸¦æ¥äº†å¾ˆé«˜çš„è®¤çŸ¥è´Ÿè·ã€‚**

![Cognitive Load](./img/cognitiveloadv5.png)

æˆ‘ä»¬åº”è¯¥å°½å¯èƒ½åœ°å‡å°‘æˆ‘ä»¬é¡¹ç›®ä¸­çš„è®¤çŸ¥è´Ÿè·ã€‚

## è®¤çŸ¥è´Ÿè·çš„ç±»å‹(Types of cognitive load)

**å†…åœ¨çš„** - ä»»åŠ¡æœ¬èº«å›ºæœ‰çš„éš¾åº¦é€ æˆçš„ã€‚å®ƒæ— æ³•è¢«é™ä½ï¼Œæ˜¯è½¯ä»¶å¼€å‘çš„æ ¸å¿ƒè¦ç´ ã€‚

**ä¸ä»»åŠ¡æ— å…³çš„** - ç”±ä¿¡æ¯æ‰€å‘ˆç°çš„æ–¹å¼ä¿ƒæˆã€‚é€šå¸¸ç”±ä¸ä»»åŠ¡ä¸ç›´æ¥ç›¸å…³çš„å› ç´ å¼•èµ·ï¼Œä¾‹å¦‚ï¼šèªæ˜äººçš„â€œéªšæ“ä½œâ€ã€‚è¿™äº›æ˜¯å¯ä»¥é¿å…çš„ã€‚æˆ‘ä»¬å°†å…³æ³¨è¿™ç§ç±»å‹çš„è®¤çŸ¥è´Ÿè·ã€‚

![Intrinsic vs Extraneous](./img/smartauthorv13.png)

è®©æˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹ä¸€äº›â€œä¸ä»»åŠ¡æ— å…³çš„â€è®¤çŸ¥è´Ÿè·çš„å…·ä½“å®é™…ä¾‹å­ã€‚

---

æˆ‘ä»¬å°†è®¤çŸ¥è´Ÿè·çš„â€œå›°æƒ‘ç¨‹åº¦â€å®šä¹‰å¦‚ä¸‹ï¼š

`ğŸ§ `: åˆšåˆå§‹åŒ–çš„â€œå·¥ä½œè®°å¿†â€ï¼Œæ²¡æœ‰è®¤çŸ¥è´Ÿè·

`ğŸ§ ++`: åœ¨æˆ‘ä»¬çš„â€œå·¥ä½œè®°å¿†â€ä¸­æ”¾å…¥äº†ä¸¤é¡¹å†…å®¹ï¼Œè®¤çŸ¥è´Ÿè·å¢åŠ ï¼ˆ`+`è¶Šå¤šï¼Œè´Ÿè·è¶Šå¤šï¼‰

`ğŸ¤¯`:åœ¨æˆ‘ä»¬çš„â€œå·¥ä½œè®°å¿†â€ä¸­æ”¾å…¥äº†è¶…è¿‡4é¡¹å†…å®¹ï¼Œâ€œå·¥ä½œè®°å¿†â€â€œæº¢å‡ºäº†â€

> æˆ‘ä»¬çš„å¤§è„‘å®é™…è¦æ›´åŠ å¤æ‚è€Œç¥ç§˜ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªç®€å•æ¨¡å‹æ¥ç®€è¦æè¿°ã€‚

## å¤æ‚çš„æ¡ä»¶æ§åˆ¶(Complex conditionals)

```go
if val > someConstant // ğŸ§ +
    && (condition2 || condition3) // ğŸ§ +++, å‰ä¸€ä¸ªæ¡ä»¶å¿…é¡»æ˜¯ true, c2 å’Œ c3 ä¸­çš„ä»»æ„ä¸€ä¸ªåº”è¯¥ä¸º true
    && (condition4 && !condition5) { // ğŸ¤¯, ç„¶åæˆ‘ä»¬å°±è¢«è¿™ä¸ªåœ°æ–¹æ•´æ‡µé€¼äº†
    ...
}
```

## åµŒå¥—çš„ ifs (Nested ifs)

```go
if isValid { // ğŸ§ +, è¿™ä¸€æ­¥æˆ‘ä»¬ç›®å‰åªå…³å¿ƒ isValid è¿™ä¸€ä¸ªå˜é‡ï¼ˆæ˜¯å¦æœ‰æ•ˆï¼‰
    if isSecure { // ğŸ§ ++, è¿™ä¸€æ­¥æˆ‘ä»¬è¦åŒæ—¶å…³å¿ƒ isValid å’Œ isSecure ä¸¤ä¸ªå˜é‡ï¼ˆæ˜¯å¦æœ‰æ•ˆå¹¶ä¸”å®‰å…¨ï¼‰
        stuff // ğŸ§ +++
    }
} 
```

å’Œâ€œææ—©è¿”å›â€åšå¯¹æ¯”ï¼š

```go
if !isValid
    return

if !isSecure
    return

// ğŸ§ , æˆ‘ä»¬ä¸ç”¨å»å…³å¿ƒå·²ç»è¿”å›çš„ä¸œè¥¿ï¼Œèµ°åˆ°è¿™ä¸€æ­¥ä»£è¡¨æ‰€æœ‰æ ¡éªŒå·²ç»é€šè¿‡

stuff // ğŸ§ +
```

æˆ‘ä»¬å¯ä»¥åªä¸“æ³¨äºæ‰€æˆ‘ä»¬å…³å¿ƒçš„å†…å®¹ï¼Œä»è€Œå°†æˆ‘ä»¬çš„â€œå·¥ä½œè®°å¿†â€ä»å„ç§å…ˆå†³æ¡ä»¶ä¸­è§£æ”¾å‡ºæ¥ã€‚

## å¤šç»§æ‰¿å™©æ¢¦ (Inheritance nightmare)

æˆ‘ä»¬è¢«è¦æ±‚ä¸ºæˆ‘ä»¬çš„ç®¡ç†å‘˜ç”¨æˆ·æ›´æ”¹ä¸€äº›å†…å®¹ `ğŸ§ `ï¼š

`AdminController extends UserController extends GuestController extends BaseController`

å™¢ï¼Œä¸€éƒ¨åˆ†çš„åŠŸèƒ½ä»£ç åœ¨`BaseContorller`ï¼Œè®©æˆ‘ä»¬ç…ç…ï¼š`ğŸ§ +`

åœ¨`GuestController` ä¸­å¼•å…¥äº†åŸºæœ¬çš„è§’è‰²æœºåˆ¶ï¼š`ğŸ§ ++`

åœ¨`UserController` ä¸­ä¿®æ”¹äº†éƒ¨åˆ†ä¸œè¥¿ï¼š`ğŸ§ +++`

ç»ˆäºï¼Œæˆ‘ä»¬æ¥åˆ°äº†`AdminController`ï¼Œè®©æˆ‘ä»¬å¼€å§‹ç¼–ç å§ï¼ï¼š`ğŸ§ ++++`

å™¢ï¼Œç­‰ä¸‹ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç»§æ‰¿äº†`AdminController`çš„`SuperuserController`ã€‚ä¿®æ”¹äº†`AdminController`çš„è¯ï¼Œä¸€äº›ç»§æ‰¿æ³ªä¸­çš„é€»è¾‘å°±ä¼šè¢«ç ´åï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆäº†è§£ä¸€ä¸‹`SuperuserController`ï¼š`ğŸ¤¯`

ä¼˜å…ˆä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿ã€‚æˆ‘ä»¬å°±ä¸å±•å¼€è¯´æ˜äº†â€”â€”è¿™é‡Œæœ‰å¾ˆå¤š[å‚è€ƒèµ„æ–™](https://www.youtube.com/watch?v=hxGOiiR9ZKg)ã€‚

## è¿‡å¤šçš„å°æ–¹æ³•ï¼Œç±»æˆ–æ¨¡å—(Too many small methods, classer or modules)

> ä¸‹è¿°æ–¹æ³•ï¼Œç±»å’Œæ¨¡å—æ˜¯å¯ä»¥ç›¸äº’æ›¿æ¢çš„

åƒ â€œæ–¹æ³•åº”è¯¥å°‘äº 15 è¡Œä»£ç â€ æˆ– â€œç±»åº”è¯¥å¾ˆå°â€ è¿™æ ·çš„å’’è¯­è¢«è¯æ˜æ˜¯æœ‰äº›é”™è¯¯çš„ã€‚

**æ·±æ¨¡å—**ã€Deep moduleã€‘- ç®€å•çš„æ¥å£å®ç°å¤æ‚çš„åŠŸèƒ½

**æµ…æ¨¡å—** ã€Shallow moduleã€‘- æ¥å£ç›¸å¯¹äºå…¶æ‰€æä¾›çš„å°åŠŸèƒ½æ¥è¯´ç›¸å¯¹å¤æ‚

![Deep module](./img/deepmodulev5.png)

æ‹¥æœ‰å¤ªå¤šçš„â€œæµ…æ¨¡å—â€ä¼šä½¿é¡¹ç›®éš¾ä»¥ç†è§£ã€‚**æˆ‘ä»¬ä¸ä»…è¦è®°ä½æ¯ä¸ªæ¨¡å—çš„èŒè´£ï¼Œè¿˜è¦è®°ä½å®ƒä»¬çš„æ‰€æœ‰äº¤äº’**ã€‚ä¸ºäº†ç†è§£â€œæµ…æ¨¡å—â€çš„ç›®çš„ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æŸ¥çœ‹æ‰€æœ‰ç›¸å…³æ¨¡å—çš„é€»è¾‘ã€‚`ğŸ¤¯`

> [ä¿¡æ¯éšè—](https://baike.baidu.com/item/%E4%BF%A1%E6%81%AF%E9%9A%90%E8%97%8F/3230616)æ˜¯æ— æ¯”é‡è¦çš„ï¼Œå½“ç„¶æˆ‘ä»¬å¹¶ä¸ä¼šåœ¨æµ…æ¨¡å—ä¸­éšè—å¾ˆå¤šå¤æ‚æ€§ã€‚

æˆ‘æœ‰ä¸¤ä¸ªå® ç‰©é¡¹ç›®ï¼Œä»–ä»¬éƒ½æœ‰å·®ä¸å¤š 5åƒè¡Œä»£ç ã€‚ç¬¬ä¸€ä¸ªé¡¹ç›®æœ‰ 80 ä¸ªâ€œæµ…ç±»â€ã€shallow class

ã€‘ï¼Œè€Œç¬¬äºŒä¸ªé¡¹ç›®åªæœ‰ 7 ä¸ªâ€œæ·±ç±»â€ã€deep classã€‘ï¼Œæˆ‘å·²ç»æœ‰ä¸€å¹´åŠæ²¡æœ‰ç»´æŠ¤è¿™ä¿©é¡¹ç›®äº†ã€‚

ä¸€æ¬¡æˆ‘å›è¿‡å¤´æ¥ç»´æŠ¤é¡¹ç›®ï¼Œæˆ‘è®¤è¯†åˆ°åœ¨ç¬¬ä¸€ä¸ªé¡¹ç›®ä¸­ç†æ¸…é‚£ 80 ä¸ªç±»ä¹‹é—´çš„æ‰€æœ‰äº¤äº’æ˜¯ä¸€ä»¶æå…¶å›°éš¾çš„äº‹æƒ…ã€‚åœ¨æˆ‘å¼€å§‹ç¼–ç ä¹‹å‰ï¼Œæˆ‘å¿…é¡»é‡æ–°å»ºç«‹å¤§é‡çš„è®¤çŸ¥è´Ÿè·ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘èƒ½å¤Ÿå¾ˆå¿«åœ°ç†è§£ç¬¬äºŒä¸ªé¡¹ç›®ï¼Œå› ä¸ºå®ƒåªæœ‰å‡ ä¸ªå…·æœ‰ç®€å•æ¥å£çš„â€œæ·±ç±»â€ã€deep classã€‘ã€‚

> æœ€å¥½çš„ç»„ä»¶æ˜¯é‚£äº›æä¾›äº†å¼ºå¤§åŠŸèƒ½ä½†æ¥å£ç®€å•çš„ç»„ä»¶ã€‚  
> 
> ** John K. Ousterhout**

UNIX I/O çš„æ¥å£éå¸¸ç®€å•ã€‚å®ƒåªæœ‰äº”ä¸ªåŸºæœ¬è°ƒç”¨ï¼š

```c
open(path, flags, permissions)
read(fd, buffer, count)
write(fd, buffer, count)
lseek(fd, offset, referencePosition)
close(fd)
```

è¿™ä¸ªæ¥å£çš„ç°ä»£å®ç°ã€modern implementationã€‘æœ‰**æ•°åä¸‡è¡Œä»£ç **ã€‚è®¸å¤šå¤æ‚æ€§éšè—åœ¨å¼•æ“ç›–ä¸‹ã€‚ç„¶è€Œï¼Œå¾—ç›Šäºå…¶ç®€å•çš„æ¥å£ï¼Œå®ƒæ˜¯å¾ˆå®¹æ˜“ä½¿ç”¨çš„ã€‚

> è¿™ä¸ªâ€œæ·±æ¨¡å—â€ã€deep moduleã€‘çš„ç¤ºä¾‹å–è‡ª John K. Ousterhout çš„ [è½¯ä»¶è®¾è®¡çš„å“²å­¦ã€A Philosophy of Software Designã€‘](https://web.stanford.edu/~ouster/cgi-bin/book.php)ä¸€ä¹¦ã€‚è¿™æœ¬ä¹¦ä¸ä»…æ¶µç›–äº†è½¯ä»¶å¼€å‘ä¸­å¤æ‚æ€§çš„æœ¬è´¨ï¼Œè€Œä¸”æ˜¯å¯¹ Parnas é¢‡å…·å½±å“åŠ›çš„è®ºæ–‡ [åˆ†è§£ç³»ç»Ÿæ¨¡å—çš„æ ‡å‡†ã€On the criteria to be used in decomposing systems into modulesã€‘](https://www.win.tue.nl/~wstomv/edu/2ip30/references/criteria_for_modularization.pdf)çš„æœ€å¤§è¯ é‡Šã€‚ä¸¤è€…éƒ½æ˜¯å¿…ä¸å¯å°‘çš„è¯»ç‰©ã€‚å…¶ä»–ç›¸å…³è¯»ç‰©ï¼š[å¯èƒ½æ˜¯æ—¶å€™åœæ­¢æ¨èæ¸…æ´ä»£ç äº†ã€It's probably time to stop recommending Clean Codeã€‘](https://qntm.org/clean)ã€[è¢«è®¤ä¸ºæœ‰å®³çš„å°å‡½æ•°ã€Small Functions considered Harmfulã€‘](https://copyconstruct.medium.com/small-functions-considered-harmful-91035d316c29)ã€‚

P.S. å¦‚æœä½ è®¤ä¸ºæˆ‘ä»¬æ˜¯åœ¨æ”¯æŒé‚£ç§è‚©è´Ÿè¶…å¤šè´£ä»»çš„ï¼Œè‡ƒè‚¿çš„â€œä¸Šå¸å¯¹è±¡â€ã€God objectsã€‘ï¼Œé‚£ä½ å°±é”™äº†ã€‚

## æµ…æ¨¡å—å’Œå•ä¸€èŒè´£åŸåˆ™(Shallow modules and SRP)

todo
